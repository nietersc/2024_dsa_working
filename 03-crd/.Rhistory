facet_grid(~krate_kgha)
# Changing to sum-to-zero contrast
options(contrasts = c("contr.sum", "contr.poly"))
attach(crd_dfw)
# Model fitting
crd_mod <- lm(yield_kgha ~ krate_kgha*nrate_kgha)
# Summary
summary(crd_mod)
# Model fitting
crd_mod <- lm(yield_kgha ~ krate_kgha*nrate_kgha)
# Summary
summary(crd_mod)
crd_mod <- lm(yield_kgha ~ krate_kgha + nrate_kgha + krate_kgha:nrate_kgha)
# Summary
summary(crd_mod)
# Model fitting
crd_mod <- lm(yield_kgha ~ krate_kgha*nrate_kgha)
# Summary
summary(crd_mod)
# Model fitting
crd_mod <- lm(yield_kgha ~ nrate_kgha*krate_kgha)
# Summary
summary(crd_mod)
anova <- anova(crd_mod)
#Anova found in car package
Anova <- Anova(crd_mod) #uses Type 3 SS - if you have missing data
anova <- anova(crd_mod) #uses Type I SS
aov <- aov(crd_mod) #uses Type I SS
summary(Anova)
#Anova found in car package
Anova <- Anova(crd_mod, type = 3) #uses Type III SS - if you have missing data
anova <- anova(crd_mod) #uses Type I SS
aov <- aov(crd_mod) #uses Type I SS
summary(Anova)
summary(anova)
#Anova found in car package
Anova(crd_mod, type = 3) #uses Type III SS - if you have missing data
anova(crd_mod) #uses Type I SS
aov(crd_mod) #uses Type I SS
#Anova found in car package
Anova(crd_mod, type = 3) #uses Type III SS - if you have missing data
anova(crd_mod) #uses Type I SS
#Anova found in car package
Anova(crd_mod, type = 3) #uses Type III SS - if you have missing data
anova(crd_mod) #uses Type I SS
aov(crd_mod) #uses Type I SS
#Anova found in car package
Anova(crd_mod, type = 3) #uses Type III SS - if you have missing data
anova(crd_mod) #uses Type I SS
aov(crd_mod) #uses Type I SS
crd_resid <- broom::augment(crd_mod)
View(crd_resid)
crd_resid <- broom::augment(crd_mod) |>
mutate(
.stud_resid = rstudent(crd_mod)
)
View(crd_resid)
crd_resid
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_point()+
geom_smooth()
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_point()+
geom_smooth(color = "green")
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_point()+
geom_smooth(color = "forestgreen")
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_point()+
geom_smooth(color = "forestgreen", fill = "green")
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_point(shape = 21)+
geom_smooth(color = "forestgreen", fill = "green")
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "forestgreen", fill = "green")+
geom_point(shape = 21)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "forestgreen", fill = "green")+
geom_point(shape = 21,
fill = "purple",
size = 3)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "forestgreen", fill = "green")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.5)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "forestgreen", fill = "green")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "purple4", fill = "green")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "purple4", fill = "green")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)+
geom_hline(yintercept = 1)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "purple4", fill = "green")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)+
geom_hline(yintercept = c(-3,0,3),
linetype = "dashed",
color = "red")
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)+
geom_hline(yintercept = c(-3,0,3),
linetype = "dashed",
color = "red")
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)+
geom_hline(yintercept = c(-3,0,3),
linetype = "dashed",
color = "red",
linewidth = 1)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_hline(yintercept = c(-3,0,3),
linetype = "dashed",
color = "red",
linewidth = 1)+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_hline(yintercept = c(-3,0,3),
linetype = "dotted",
color = "red",
linewidth = 1)+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_hline(yintercept = c(-3,0,3),
linetype = "dotted",
color = "red",
linewidth = 2)+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_hline(yintercept = c(-3,0,3),
color = "red",
linewidth = 2)+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_hline(yintercept = c(-3,0,3),
color = "red",
linewidth = 1.5)+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_hline(yintercept = c(-3,0,3),
color = "red",
linewidth = 1)+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
crd_resid |>
ggplot(aes(x = .fitted, y = .stud_resid))+
geom_hline(yintercept = c(-3,0,3),
color = "red",
linewidth = 1,
alpha = 0.5)+
geom_smooth(color = "purple4", fill = "purple")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = 0.7)
ggplot(crd_resid, aes(x=.fitted, y=.stud_resid))+
geom_hline(yintercept = 0, color="red")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = .7)+
geom_smooth()+
geom_hline(yintercept = c(-3,3), color = "red")+
theme_bw()
crd_resid |>
ggplot(y = .resid)+
geom_density()
crd_resid |>
ggplot(aes(y = .resid))+
geom_density()
crd_resid |>
ggplot(aes(x = .resid))+
geom_density()
crd_resid |>
ggplot(aes(x = .resid, fill = .resid))+
geom_density()
crd_resid |>
ggplot(aes(x = .resid, fill = "purple"))+
geom_density()
crd_resid |>
ggplot(aes(sample = .stud_resid))+
stat_qq()
crd_resid |>
ggplot(aes(sample = .stud_resid))+
stat_qq()+
stat_q
crd_resid |>
ggplot(aes(sample = .stud_resid))+
stat_qq()+
stat_qq_line()
crd_resid |>
ggplot(aes(sample = .stud_resid))+
stat_qq()+
stat_qq_line()+
stat_unique()
crd_resid |>
ggplot(aes(sample = .stud_resid))+
stat_qq()+
stat_qq_line()+
stat_quantile()
crd_resid |>
ggplot(aes(sample = .stud_resid))+
stat_qq()+
stat_qq_line()
crd_resid |>
ggplot(aes(x = .resid))+
geom_density()
crd_resid |>
ggplot(aes(x = .resid))+
geom_density(fill = "purple")
crd_resid |>
ggplot(aes(x = .resid))+
geom_density(fill = "purple",
alpha = 0.5)
crd_resid |>
ggplot(aes(x = .stud_resid))+
geom_density(fill = "purple",
alpha = 0.5)
crd_resid |>
ggplot(aes(x = .stud_resid))+
geom_density(fill = "purple",
alpha = 0.3)
crd_resid |>
ggplot(aes(x = .stud_resid))+
geom_density(fill = "purple",
alpha = 0.2)
crd_resid |>
ggplot(aes(x = .stud_resid))+
geom_density(fill = "purple",
alpha = 0.2)+
theme_minimal()
crd_resid |>
ggplot(aes(x = .stud_resid))+
geom_density(fill = "purple",
alpha = 0.2)+
scale_x_continuous(
breaks = c(-3,0,3)
)+
theme_minimal()
crd_resid |>
ggplot(aes(x = .stud_resid))+
geom_density(fill = "purple",
alpha = 0.2)+
scale_x_continuous(
breaks = c(-3,0,3),
limits = c(-3,3)
)+
theme_minimal()
ggplot(crd_resid, aes(x=.fitted, y=.stud_resid))+
geom_hline(yintercept = 0, color="red")+
geom_point(shape = 21,
fill = "purple",
size = 3,
alpha = .7)+
geom_smooth()+
geom_hline(yintercept = c(-3,3), color = "red")+
theme_bw()
#compare all means across all treatments
crd_means_all <- emmeans::emmeans(crd_mod,
~nrate_kgha*krate_kgha)
View(crd_means_all)
#compare all means across all treatments
crd_means_all <- emmeans::emmeans(crd_mod,
~nrate_kgha:krate_kgha)
crd_means_all
View(crd_means_all)
crd_means_nk <- emmeans(crd_mod,
~nrate_kgha|krate_kgha)
crd_means_nk
crd_means_kn <- emmeans(crd_mod,
~krate_kgha|nrate_kgha)
crd_means_kn
crd_means_nk <- emmeans(crd_mod,
~nrate_kgha|krate_kgha)
crd_means_nk
#cld = compact letter display
crd_cld_all <- cld(crd_means_all)
View(crd_cld_all)
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T)
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T)
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T,
Letters = letters)
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T,
Letters = letters)
View(crd_cld_all)
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T,
Letters = letters,
adjust = "tukey")
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T,
Letters = letters,
adjust = "sidak")
crd_cld_all
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T,
Letters = letters,
adjust = "none")
crd_cld_all
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T,
Letters = letters,
adjust = "tukey")
#cld = compact letter display
crd_cld_all <- cld(crd_means_all,
reversed = T,
Letters = letters,
adjust = "none")
crd_cld_all
crd_cld_nk
crd_cld_nk <- cld(crd_means_nk,
reversed=T,
adjust="none",
Letters=letters)
crd_cld_nk
crd_means_nk <- emmeans(crd_mod,
~nrate_kgha|krate_kgha)
```{r interaction means k inside n}
crd_means_kn <- emmeans(crd_mod,
~krate_kgha|nrate_kgha)
crd_cld_nk <- cld(crd_means_nk,
reversed=T,
adjust="none",
Letters=letters)
crd_cld_nk
crd_cld_kn <- cld(crd_means_kn,
reversed=T,
adjust="none",
Letters=letters)
crd_cld_kn
View(crd_cld_all)
crd_cld_selected <- crd_cld_all|>
as.data.frame()
View(crd_cld_all)
View(crd_cld_selected)
View(crd_cld_selected)
crd_cld_selected <- crd_cld_all|>
as.data.frame() |>
mutate(
letter = trimws(.group)
)
crd_cld_selected <- crd_cld_all|>
as.data.frame() |>
mutate(
letter = trimws(.group),
trt_name = paste0(nrate_kgha,"+",krate_kgha)
)
# Raw data and boxplots
ggplot()+
geom_boxplot(data = crd_dfw,
aes(x = trt_name, y = yield_kgha))
# Raw data and boxplots
ggplot()+
geom_boxplot(data = crd_dfw,
aes(x = trt_name, y = yield_kgha,
color = trt_name, fill = trt_name))
# Raw data and boxplots
ggplot()+
geom_boxplot(data = crd_dfw,
aes(x = trt_name, y = yield_kgha,
color = trt_name))
# Raw data and boxplots
ggplot()+
geom_boxplot(data = crd_dfw,
aes(x = trt_name, y = yield_kgha,
color = trt_name))+
geom_label(data = crd_cld_selected,
aes(x = trt_name, y = emmean,
label = letter))
crd_cld_selected <- crd_cld_all|>
as.data.frame() |>
mutate(
letter = trimws(.group),
trt_name = paste0(krate_kgha,"+",nrate_kgha)
)
crd_cld_selected
# Raw data and boxplots
ggplot()+
geom_boxplot(data = crd_dfw,
aes(x = trt_name, y = yield_kgha,
color = trt_name))+
geom_label(data = crd_cld_selected,
aes(x = trt_name, y = emmean,
label = letter))
# Loading packages
library(tidyverse) # for data wrangling and plotting
library(car) # for Anova function
library(broom) # for model residuals extraction
library(emmeans) # for model mean extraction
library(multcomp) # for pairwise comparison letter display
library(multcompView)
crd_df <- read.csv("data/wheat_nk_balkh.csv")
crd_df1 <- crd_df |>
mutate(
trt_name = paste0(krate_kgha,"+",nrate_kgha)
)|>
pivot_longer(
c(3:4),
names_to = "nutrient",
values_to = "rate_kgha"
)|>
separate(
nutrient,
into = c("nutrient","remove"),
sep = "_"
)|>
dplyr::select(-remove) |>
dplyr::mutate(
element = case_when(
grepl(x = nutrient, pattern = "k") ~ "k",
grepl(x = nutrient, pattern = "n") ~ "n"
)
)|>
mutate_at(vars(rate_kgha,rep), as.factor)
crd_dfw <- crd_df |>
mutate_at(
vars(krate_kgha,nrate_kgha,rep), as.factor)|>
mutate(
trt_name = paste0(krate_kgha,"+",nrate_kgha)
)
# Changing to sum-to-zero contrast
options(contrasts = c("contr.sum", "contr.poly"))
attach(crd_dfw)
# Model fitting
crd_mod <- lm(yield_kgha ~ nrate_kgha*krate_kgha)
crd_mod <- lm(yield_kgha ~ krate_kgha + nrate_kgha + krate_kgha:nrate_kgha)
# Summary
summary(crd_mod)
crd_resid <- broom::augment(crd_mod) |>
mutate(
.stud_resid = rstudent(crd_mod)
)
crd_resid
